@model dynamic

@{
    Layout = null;
    ViewBag.Title = "Profile Picture";
}

<h2>Profile Picture</h2>

<form>
    <div class="form-group">
        <div class="well" id="canvas-holder">
            <canvas id="canvas-preview"></canvas>
        </div>
    </div>
    <div class="form-group">
        <label>Upload File</label>
        <input id="profile-upload" type="file"/>
    </div>
    <div class="form-actions">
        <button type="submit">Submit</button>
    </div>
</form>

<script src="~/Scripts/jquery-1.9.1.js"></script>
    <script>
        $(function() {
            $("#profile-upload").on('change', function (e) {
                e.preventDefault();
                
                // from an input element
                var filesToUpload = this.files;

                if (filesToUpload.length !== 1) return;

                var file = filesToUpload[0];

                if (!file.type.match(/image.*/)) {
                    alert("only images, please");
                }
                
                var img = new Image();
                img.onload = function() {
                    var canvas = document.getElementById("canvas-preview");
                    resizeImage(img, canvas);
                    //canvas.width = img.width;
                    //canvas.height = img.height;
                    //canvas.getContext("2d").drawImage(img, 0, 0);
                };
                img.src = window.URL.createObjectURL(file);
            });
        });
        
        function resizeImage(img, canvas) {
            var MAX_WIDTH = 800;
            var MAX_HEIGHT = 600;
            var width = img.width;
            var height = img.height;

            if (width > height) {
                if (width > MAX_WIDTH) {
                    height *= MAX_WIDTH / width;
                    width = MAX_WIDTH;
                }
            } else {
                if (height > MAX_HEIGHT) {
                    width *= MAX_HEIGHT / height;
                    height = MAX_HEIGHT;
                }
            }
            canvas.width = width;
            canvas.height = height;
            var ctx = canvas.getContext("2d");
            ctx.drawImage(img, 0, 0, width, height);
        }
    </script>
