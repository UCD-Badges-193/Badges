@model Badges.Models.Profile.ProfileEditModel

@{
    ViewBag.Title = "Your Profile";
}

@section AdditionalStyles
{
    <link href="~/Content/jquery.Jcrop.css" rel="stylesheet" />
}

@using (Html.BeginForm("Edit", "Profile", FormMethod.Post, new {enctype = "multipart/form-data"}))
{
    @Html.AntiForgeryToken()

    <div class="profile-edit">
        @Html.Partial("_ProfileForm")
    </div>
}

@section AdditionalScripts
{
    <script src="~/Scripts/jquery.Jcrop.js"></script>
    <script>
        var cropper;
        $(function() {
            $("#profile-upload").change(function() {
                var filesToUpload = this.files;
                if (filesToUpload.length !== 1) return;

                var file = filesToUpload[0];

                if (!file.type.match(/image.*/)) {
                    alert("only images, please");
                }

                var img = document.getElementById("profile-picture");
                img.src = window.URL.createObjectURL(file);
                
                if (cropper) {
                    cropper.destroy();
                }
                
                $(img).Jcrop({
                        aspectRatio: 1,
                        allowSelect: false,
                        allowResize: true, //Maybe we allow resize and then shrink the img?
                        onChange: function (c) { console.log(c); },
                        onSelect: function (c) { console.log(c); }
                    }, function () {
                        cropper = this;
                        cropper.animateTo([0, 0, 120, 120]);
                    });
            });
        });
    </script>
}
